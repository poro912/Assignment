h1. URL

{{>TOC}}

h2. [[Suricata-update_rule-set|suricata rule-set]]

h2. ìˆ˜ë¦¬ì¹´íƒ€ ê³µì‹ ë¬¸ì„œ

* https://docs.suricata.io/en/suricata-6.0.3/index.html
* https://docs.suricata.io/en/suricata-6.0.3/rules/intro.html

h2. ìˆ˜ë¦¬ê°€ì¹´ ì—…ë°ì´íŠ¸ ê³µì‹ ë¬¸ì„œ

* https://suricata-update.readthedocs.io/en/latest/index.html

h2. ìˆ˜ë¦¬ì¹´íƒ€ ì •ë¦¬ ë¸”ë¡œê·¸

* https://boying-blog.tistory.com/33
* "saynot tistory":https://saynot.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-Suricata%EC%88%98%EB%A6%AC%EC%B9%B4%ED%83%80-%EA%B3%B5%EB%B6%80

h2. ì •ê·œí‘œí˜„ì‹

* "ì •ê·œ í‘œí˜„ì‹ wiki":https://en.wikipedia.org/wiki/Regular_expression
* "Learn Regex git":https://github.com/ziishaned/learn-regex/blob/master/translations/README-ko.md
* "Dev Docs git ì •ê·œì‹ í˜ì´ì§€":https://github.com/im-d-team/Dev-Docs/blob/master/Javascript/Regular_Expressions.md

h2. ê¸°íƒ€

* "Intel Hyperscan":https://www.intel.com/content/www/us/en/developer/articles/technical/introduction-to-hyperscan.html
* "suri-stats gití˜ì´ì§€":https://github.com/regit/suri-stats
* "suricata-stats gití˜ì´ì§€":https://github.com/cvandeplas/suricata_stats
* "Suricata monitoring with Zabbix or other":http://christophe.vandeplas.com/2013/11/suricata-monitoring-with-zabbix-or-other.html
* "ê¸°ë³¸ index.yaml URL":https://www.openinfosecfoundation.org/rules/index.yaml

h1. Suricata

h2. íŠ¹ì§•

* ë†’ì€ ì„±ëŠ¥ì˜ IDS, IPS ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ ì—”ì§„
* ë©”íƒ€, IP, TCP, UDP, ICMP, í˜ì´ë¡œë“œ, ë³€í™˜, í•„í„°, Flow, ByPass, HTTP, File, DNS, SSL/TLS, SSH ë“± ëŒ€ë¶€ë¶„ì„ ê°ì§€, ì°¨ë‹¨ ê°€ëŠ¥í•˜ë‹¤
* Snortì˜ ë‹¨ì ì¸ ë‹¨ì¼ ìŠ¤ë ˆë“œ ì²˜ë¦¬ ë°©ì‹ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤
* Snort ë£°ì´ í˜¸í™˜ë˜ì–´ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
* ë¡œë“œ ë°¸ëŸ°ì‹±, RSS, ì˜¤í”„ë¡œë“œ ì§€ì›
* ë‹¤ì¤‘ì½”ì–´ ë‹¤ì¤‘ ì“°ë ˆë“œ ì§€ì›

h2. ë””ë ‰í„°ë¦¬

<pre>
ğŸ“‚etc
â”— ğŸ“‚suricata
  â”£ classification.config       ì´ë²¤íŠ¸ ë¶„ë¥˜ì— ê´€í•œ ì„¤ì • (ì´ˆê¸°ì„¤ì • ì‹œ ì‚¬ìš©)
  â”£ reference.config            ê·œì¹™ì— ëŒ€í•œ ì°¸ì¡° ë° ì¶”ê°€ì •ë³´
  â”£ suricata.yaml               ë™ì‘ ë° ì„¤ì •ì„ ì§€ì •
  â”— threshold.config            ì„¸ë¶€ì ì¸ ê°ì§€ ì œí•œì„ ì¡°ì •, ì„ê³„ê°’ ì„¤ì •

ğŸ“‚var
â”£ ğŸ“‚lib
  â”— ğŸ“‚suricata
    â”£ ğŸ“‚update
      â”£ ğŸ“‚sources                       ì‚¬ìš©ì¤‘ì¸ ê·œì¹™ì˜ ìƒíƒœ (í™œì„±í™”/ë¹„í™œì„±í™”)
      â”— ğŸ“‚cache
        â”— index.yaml                    ê·œì¹™ ë¦¬ìŠ¤íŠ¸ ì •ë³´ ì €ì¥
    â”— ğŸ“‚rules
      â”£ classification.config           ì´ë²¤íŠ¸ ë¶„ë¥˜ì— ê´€í•œ ì„¤ì • íŒŒì¼ (ëŸ°íƒ€ì„ì¤‘ì— ì‚¬ìš©)
      â”£ suricata.rules                  ê¸°ë³¸ì œê³µ ë£°ì„ ì €ì¥
      â”— ğŸ“‚.cache
        â”— index.yaml                    ë‹¤ìš´ë¡œë“œí•œ ì†ŒìŠ¤ ì¸ë±ìŠ¤ê°€ ìºì‹œ
      
â”— ğŸ“‚log
  â”— ğŸ“‚suricata 
    â”£ eve.json                  ì´ë²¤íŠ¸ ë¡œê·¸ ì €ì¥
    â”£ fast.log                  íƒì§€ë¡œê·¸ ì €ì¥ 
    â”£ stats.log                 ì„±ëŠ¥ í†µê³„ ì €ì¥
    â”£ suricata-start.log        ì‹œì‘ì‹œ ë°œìƒí•œ ì´ë²¤íŠ¸ì™€ ì´ˆê¸°í™” ê´€ë ¨ ë¡œê·¸
    â”— suricata.log              ê°ì§€í•œ ì´ë²¤íŠ¸ ê´€ë ¨ ë¡œê·¸ ê¸°ë¡

ğŸ“‚usr
â”— ğŸ“‚share
  â”— ğŸ“‚suricata
    â”— ğŸ“‚rules                   ë‹¤ìš´ë°›ì€ ë£°ì„ ì €ì¥í•¨
</pre>


h2. ì„¤ì¹˜

<pre><code class="shell">
#!/bin/bash
sudo add-apt-repository ppa:oisf/suricata-stable
sudo apt-get update
sudo apt-get install suricata

# ê·¸ë£¹ ìƒì„±
sudo groupadd suricata

# ë””ë ‰í„°ë¦¬ì™€ íŒŒì¼ ê·¸ë£¹ ë³€ê²½
sudo chgrp -R suricata /etc/suricata
sudo chgrp -R suricata /var/lib/suricata/rules
sudo chgrp -R suricata /var/lib/suricata/update

#ê¶Œí•œ ì„¤ì •
sudo chmod -R g+r /etc/suricata/
sudo chmod -R g+rw /var/lib/suricata/rules
sudo chmod -R g+rw /var/lib/suricata/update

ê·¸ë£¹ ì‚¬ìš©ì ì¶”ê°€
sudo usermod -a -G suricata <username>
</code></pre>

h2. ë£° ì ìš© í…ŒìŠ¤íŠ¸

<pre><code># suricata ë™ì‘
sudo suricata -i eth0 -D

# ë£° íŒŒì¼ ìƒì„±
mkdir local.rules

# ë£° ì¶”ê°€
vi local.rules
alert icmp $HOME_NET any -> $EXTERNAL_NET any (msg: "ICMP 8.8.8.8 Running"; sid:1000003; rev:1;)

# ë£°íŒŒì¼ ì¶”ê°€
sudo vi /etc/suricata/suricata.yaml
	rule-files:
			- <ê²½ë¡œ>/local.rules

# suricata ì¬ì‹œì‘
sudo suricatasc -c ruleset-reload-nonblocking

# ë¡œê·¸ í™•ì¸
tail -f /var/log/suricata/fast.log

# í•‘ ì „ì†¡
ping 8.8.8.8
</code></pre>

---

h2. ìš©ì–´

* PCAP (Packet Capture)
** ë„¤íŠ¸ì›Œí¬ ìƒì— ë– ëŒì•„ë‹¤ë‹ˆëŠ” íŒ¨í‚·ì˜ í¬ì°©

* Building Blocks
** ìˆ˜ë¦¬ì¹´íƒ€ë¥¼ êµ¬ì„±í•˜ëŠ” ìŠ¤ë ˆë“œ í˜¸ì¹­

* íŒ¨í‚·ì²˜ë¦¬ ìŠ¤ë ˆë“œ
** íŒ¨í‚·ì„ ë°›ì•„ ë¶„ì„í•˜ëŠ” ìŠ¤ë ˆë“œ

* ìº¡ì³ ìŠ¤ë ˆë“œ
** ë¡œë“œë°¸ëŸ°ì‹±ì„ ìˆ˜í–‰í•˜ëŠ” ìŠ¤ë ˆë“œ

h2. ê¸°ëŠ¥

h3. runmode

* "Suricata runmodes":https://docs.suricata.io/en/suricata-6.0.3/performance/runmodes.html
* --list-runmodes ì˜µì…˜ì„ í†µí•´ ëŸ°ëª¨ë“œ ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
* workers
** í•˜ë‚˜ ì´ìƒì˜ íŒ¨í‚·ì²˜ë¦¬ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•œë‹¤.
** ë³´í†µ ê°€ì¥ ì¢‹ì€ ì„±ëŠ¥ì„ ë°œíœ˜í•œë‹¤.
* autofp
** í•˜ë‚˜ ì´ìƒì˜ ìº¡ì³ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•œë‹¤.
* single
** íŒ¨í‚· ì²˜ë¦¬ ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ë§Œ ì‚¬ìš©í•œë‹¤.
** ê°œë°œì‹œì ì— ìœ ë¦¬í•˜ë‹¤.


h3. ë¡œë“œ ë°¸ëŸ°ì‹±

* workers ëª¨ë“œì—ì„œ ê°€ì¥ ì¢‹ì€ ì„±ëŠ¥ì„ ë°œíœ˜í•œë‹¤.

h3. RSS (Recevie Side Scaling)

* íŠ¸ë˜í”½ì„ ë¶„ì‚° ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ìˆ 
* íŠ¸ë˜í”½ ë¶„ì‚° ì‹œ ì„œë¡œ ë‹¤ë¥¸ íì— ëŒ€ê¸°í•˜ëŠ” ê²½ìš° íƒ€ì´ë° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
** hand shake ì‹œ SYN/ACKíŒ¨í‚·ì´ ë’¤ëŠ¦ê²Œ ë„ì°©í•  ìˆ˜ ìˆë‹¤.
** ì´ ê²½ìš° ìœ íš¨í•˜ì§€ ì•Šì€ íŒ¨í‚·ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.

h3. ì˜¤í”„ë¡œë“œ

* ê¸°ë³¸ì ìœ¼ë¡œ NIC ë° ë“œë¼ì´ë²„ì—ì„œ ì œê³µí•˜ëŠ” ì˜¤í”„ë¡œë“œ ê¸°ëŠ¥ì€ ë¹„í™œì„±í™” í•´ì•¼í•¨
* LRO/GROë¥¼ ë¹„í™œì„±í™” í•´ì•¼í•¨
** LRO : ëŒ€ê·œëª¨ ìˆ˜ì‹  ì˜¤í”„ë¡œë“œ
** GRO : ì¼ë°˜ ìˆ˜ì‹  ì˜¤í”„ë¡œë“œ

h3. í•˜ì´í¼ìŠ¤ìº”

* "Intel Hyperscan":https://www.intel.com/content/www/us/en/developer/articles/technical/introduction-to-hyperscan.html
* ë‹¤ì¤‘ ì •ê·œì‹ ë§¤ì¹­ ë¼ì´ë¸ŒëŸ¬ë¦¬
* C++ë¡œ ì •ê·œì‹ ì»´íŒŒì¼ëŸ¬ë¥¼ ì œê³µí•œë‹¤.
* ì‚¬ìš©ì„ ìœ„í•´ì„œëŠ” suricata.yaml íŒŒì¼ í¸ì§‘ì„ í†µí•´ ì¢…ì†ì„±ì„ ì„¤ì •í•´ì•¼í•œë‹¤.

h3. í†µê³„

* 8ì´ˆë§ˆë‹¤ ê³ ì •ëœ ê°„ê²©ìœ¼ë¡œ í†µê³„ ë ˆì½”ë“œë¥¼ ìƒì„±í•œë‹¤.
* íŒ¨í‚· ì†ì‹¤ í†µê³„ë¥¼ ë³´ê³ í•œë‹¤.
* AF_PACKET ëª¨ë“œ
** Capture.kernel_packets
*** ì‚¬ìš©ì ê³µê°„ìœ¼ë¡œ ì „ë‹¬ëœ íŒ¨í‚· ìˆ˜
** Capture.kernel_drops
*** íê¸°ì²˜ë¦¬ëœ íŒ¨í‚· ìˆ˜
* PF_PING ëª¨ë“œ
** Capture.kernel_packets
*** pf_ringì—ì„œ ë³¸ ì´ íŒ¨í‚· ìˆ˜
** Capture.kernel_drops
*** íê¸°ì²˜ë¦¬ëœ íŒ¨í‚· ìˆ˜

h3. ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ë„êµ¬

* "suri-stats gití˜ì´ì§€":https://github.com/regit/suri-stats
* "suricata-stats gití˜ì´ì§€":https://github.com/cvandeplas/suricata_stats
* "Suricata monitoring with Zabbix or other":http://christophe.vandeplas.com/2013/11/suricata-monitoring-with-zabbix-or-other.html

h3. íŒ¨í‚· í”„ë¡œíŒŒì¼ë§

* íŒ¨í‚·ì„ ì²˜ë¦¬í•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì•Œë ¤ì¤Œ
* íŠ¹ì • íŒ¨í‚·ì´ ë” ë¹ ë¥´ê±°ë‚˜ ëŠë¦¬ê²Œ ì²˜ë¦¬ë˜ëŠ” ì´ìœ ë¥¼ ì•Œê³ ì‹¶ì€ ê²½ìš° ì‚¬ìš©

h3. ê·œì¹™ í”„ë¡œíŒŒì¼ë§

* ê·œì¹™ë²ˆí˜¸ì— ëŒ€í•œ í†µê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

h3. ë¬¸ì œ ë° ì„±ëŠ¥ ë¶„ì„ ë„ìš° ë° ë©”ë‰´ì–¼

* "Suricata analysis í˜ì´ì§€":https://docs.suricata.io/en/suricata-6.0.3/performance/analysis.html
* ë¬¸ì œë¥¼ ì‰½ê²Œ ì°¾ëŠ” ë°©ë²•, ê³ ë ¤ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…ë˜ì–´ìˆë‹¤.
* ì‹œìŠ¤í…œ ë¶€í•˜
** htop ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ì–´ ì‚¬ìš©ëŸ‰ì„ ë¶„ì„í•  ìˆ˜ ìˆë‹¤.
* ë¡œê·¸ íŒŒì¼
** stats.log ë° suricata.log íŒŒì¼ì— ë¬¸ì œê°€ ê¸°ë¡ëœë‹¤.
** Capture.kernel_dropsëŠ” Capture.kernel_packetsì˜ 1% ë¯¸ë§Œì´ì–´ì•¼ í•œë‹¤.

---

h1. suricata ë¬¸ë²•

* "Suricata Rule í˜ì´ì§€":https://docs.suricata.io/en/suricata-6.0.3/rules/intro.html
* 
|=. Action|\6=. header|=. option|
|=. Action|=. Protocol|=. SrcIP|=. srcPort|=. ->|=. DstIP|=. DDstPort|=. (Option)|

h2. example

> drop tcp $HOME_NET any -> $EXTERNAL_NET any 
> (msg:â€ET TROJAN Likely Bot Nick in IRC (USA +..)â€; flow:established,to_server; flowbits:isset,is_proto_irc; 
> content:â€NICK â€œ; pcre:â€/NICK .*USA.*[0-9]{3,}/iâ€; reference:url,doc.emergingthreats.net/2008124; 
> classtype:trojan-activity; sid:2008124; rev:2;)

h2. Action

* 
| alert		| ê²½ê³  ë°œìƒ ë° ë¡œê·¸ ê¸°ë¡	|
| pass		| íŒ¨í‚· ë¬´ì‹œ			|
| drop		| íŒ¨í‚· ì°¨ë‹¨ ë° ë¡œê·¸ ê¸°ë¡	|
| reject	| íŒ¨í‚· ì°¨ë‹¨ ë° ë¡œê·¸ ê¸°ë¡(ì¸ë¼ì¸ êµ¬ì¡°)		|
| rejectsrc	| íŒ¨í‚· ì°¨ë‹¨ ë° ë¡œê·¸ ê¸°ë¡(ì¸ë¼ì¸ êµ¬ì¡°)		|
| rejectdst	| ì¼ì¹˜í•˜ëŠ” íŒ¨í‚·ì˜ ìˆ˜ì‹ ìì—ê²Œ RST/ICMP ì˜¤ë¥˜ íŒ¨í‚·ì„ ë³´ë‚¸ë‹¤.|
| rejectboth	| ì–‘ìª½ ëª¨ë‘ì—ê²Œ RST/ICMP ì˜¤ë¥˜ íŒ¨í‚·ì„ ë³´ë‚¸ë‹¤.	|


h2. Protocol

* 
| tpc	| TCP		|
| udp	| UDP		|
| icmp	| ICMP		|
| ip	| IP ì „ì²´	|
| any	| ì „ì²´		|

h2. SrcIP / DstIP

* 
| 192.168.100.2/32	| íŠ¹ì • HOST|
| 192.168.100.0/24	| ì„œë¸Œë„·|
| [192.168.100.0/24, 192.168.101.0/24]	| ì„œë¸Œë„· ì§‘í•©|
| !192.168.100.2	| ì œì™¸í•œ ëª¨ë“  IP ì£¼ì†Œ|
| !192.168.100.0/24	| ì œì™¸í•œ ëª¨ë“  ì„œë¸Œë„·|
| ![192.168.100.2, 192.168.100.3]	| ì„œë¸Œë„· ì§‘í•©ì„ ì œì™¸í•œ ëª¨ë“  ì£¼ì†Œ|
| $HOME_NET		| ë‚´ë¶€ IP ì£¼ì†Œ ë³€ìˆ˜|
| $EXTERNAL_NET		| ì™¸ë¶€ IP ì£¼ì†Œ ë³€ìˆ˜|
| $XXX_SERVERS		| íŠ¹ì • ì„œë²„ IP ì£¼ì†Œ ë³€ìˆ˜|

h2. SrcPort / DstPort

* 
| 80		| íŠ¹ì • í¬íŠ¸ |
| [1:500]	| í¬íŠ¸ ë²”ìœ„ |
| [80,81,82]	| í¬íŠ¸ ì§‘í•© |
| !80		| íŠ¹ì • í¬íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í¬íŠ¸ |
| ![1:500]	| í¬íŠ¸ ë²”ìœ„ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í¬íŠ¸ |
| ![80,81,82]	| í¬íŠ¸ ì§‘í•©ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í¬íŠ¸ |
| any		| ëª¨ë“  í¬íŠ¸ |


h2. Option

* "Suricata Option í˜ì´ì§€":https://docs.suricata.io/en/suricata-6.0.3/rules/index.html

h3. ì¼ë°˜ ì˜µì…˜

* 
| msg		| ê²½ê³  ì´ë²¤íŠ¸ ë©”ì‹œì§€		| msg:"ë©”ì‹œì§€ ë‚´ìš©";|
| sid		| ë£° ì‹ë³„ì(3000000 ì´ìƒ ê¶Œì¥)	| sid:3000001;|
| rev		| ë£° ë²„ì „			| rev:1;|
| priority	| ìš°ì„ ìˆœìœ„			| priority:1;|
| clastype	| ìŠ¤ë…¸íŠ¸ ë£° ë¶„ë¥˜		| classtype:ë¶„ë¥˜ì´ë¦„;|
| reference	| ì·¨ì•½ì  ì°¸ê³  ë°°í¬ URL ê²½ë¡œ	| reference:íƒ€ì…, reference ë‚´ìš©;|


h3. íë¦„ ì˜µì…˜

* 
| flwow		| íë¦„ ì˜µì…˜ ëª…ë ¹ì–´|
| to_server or from_client	| í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„ íŒ¨í‚· ë£° ë§¤ì¹­|
| to_client or from_server	| ì„œë²„ -> í´ë¼ì´ì–¸íŠ¸ íŒ¨í‚· ë£° ë§¤ì¹­|
| established	| ì„¸ì…˜ì´ ì—°ê²°ëœ ìƒíƒœì˜ íŒ¨í‚· ë£° ë§¤ì¹­|
| statless	| ì„¸ì…˜ ì—°ê²° ìœ ë¬´ì™€ ìƒê´€ì—†ì´ ë£° ë§¤ì¹­|
| flow:to_server,established	| í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„ ì„¸ì…˜ ì—°ê²° íŒ¨í‚· ë£° ë§¤ì¹­|

h3. í˜ì´ë¡œë“œ ì˜µì…˜

* 
| content	|ë¬¸ì/ìˆ«ì íƒì§€			| content:"xxx";
							content:<notextile>"|16ì§„ìˆ˜|"</notextile>;|
| nocase	|ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ íƒì§€	| content:"xxx"; nocase;|
| offset	|ì§€ì •í•œ ë°”ì´íŠ¸ë²ˆì§¸ë¶€í„° íƒì§€	| offset:3;|
| depth		|ì§€ì •í•œ ë°”ì´íŠ¸ê¹Œì§€ íƒì§€		| depth:3;|
| distance	|content ë§¤ì¹­ í›„ ì§€ì • ìœ„ì¹˜ ì´í›„ ë‹¤ë¥¸ content íƒìƒ‰	|content:"xxx"; content"yyy"; distance:5;|
| within	|content ë§¤ì¹­ í›„ ì§€ì • ìœ„ì¹˜ ì•ˆì— ë‹¤ë¥¸ content íƒìƒ‰	| content:"xxx"; content"yyy"; within:5;|
| pcre		|ì •ê·œí™” í‘œê¸°, '/'ëŠ” ì‹œì‘ê³¼ ëì— í‘œê¸°
				16ì§„ìˆ˜ëŠ” ì•ì— \x í‘œê¸°	| <notextile>pcre:"/(http|ftp) Traffic/"</notextile>|


h3. HTTP íƒìƒ‰ ì˜µì…˜

* 
| http_method		| í˜ì´ë¡œë“œ ì•ë¶€ë¶„ HTTPë©”ì†Œë“œ íŒ¨í„´ ë§¤ì¹­|
| http_url		| í˜ì´ë¡œë“œ HTTP URL íŒ¨í„´ ë§¤ì¹­|
| http_cookie		| í˜ì´ë¡œë“œ HTTP ì¿ í‚¤ íŒ¨í„´ ë§¤ì¹­|
| http_header		| HTTP ìš”ì²­/ì‘ë‹µ Header ë‚´ìš© íŒ¨í„´ ë§¤ì¹­|
| http_client_body	| HTTP ìš”ì²­/ì‘ë‹µ Body ë‚´ìš© íŒ¨í„´ ë§¤ì¹­|
| http_stat_code	| HTTP ì‘ë‹µ ìƒíƒœ ì½”ë“œ íŒ¨í„´ ë§¤ì¹­|
| http_stat_message	| HTTP ì‘ë‹µ ìƒíƒœ ë©”ì„¸ì§€ íŒ¨í„´ ë§¤ì¹­|



h2. pcre

* (Perl Compatible Regular Expressions)
* "ì •ê·œ í‘œí˜„ì‹ wiki":https://en.wikipedia.org/wiki/Regular_expression
* "Learn Regex git":https://github.com/ziishaned/learn-regex/blob/master/translations/README-ko.md
* "Dev Docs git ì •ê·œì‹ í˜ì´ì§€":https://github.com/im-d-team/Dev-Docs/blob/master/Javascript/Regular_Expressions.md
* content ì •ë³´ë¥¼ ì„¸ë°€í•˜ê²Œ ê²€ìƒ‰í•  ë•Œ ì‚¬ìš©í•œë‹¤
* ë©”íƒ€ë¬¸ì, ìˆ«ì, í´ë˜ìŠ¤, ì„œë¸ŒíŒ¨í„´, ì˜µì…˜ìœ¼ë¡œ êµ¬ì„±
* pcre:"/ì •ê·œì‹/ì˜µì…˜";


h3. ì˜µì…˜

* 
| i	| ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ ê²€ìƒ‰	|
| s	| ì¤„ì´ ë„˜ì–´ê°€ë„ í•œì¤„ë¡œ ì¸ì‹	|
| x	| íŒ¨í„´ì˜ ë³´ë“  ê³µë°± ë¬´ì‹œ	|

h3. HTTP ì˜µì…˜

* 
| M	| HTTP ë©”ì†Œë“œ íŒ¨í„´ ë§¤ì¹­			|
| U	| ì •ê·œí™”ëœ URL ë””ì½”ë”© ë¬¸ìì—´ íŒ¨í„´ ë§¤ì¹­	|
| H	| ì •ê·œí™”ëœ HTTP ìš”ì²­ ë©”ì„¸ì§€ Header ë‚´ìš© íŒ¨í„´ ë§¤ì¹­	|
| P	| HTTP ìš”ì²­ ë©”ì„¸ì§€ Body ë‚´ìš© íŒ¨í„´ ë§¤ì¹­	|
| S	| HTTP ì‘ë‹µ ì½”ë“œ íŒ¨í„´ ë§¤ì¹­		|
| Y	| HTTP ì‘ë‹µ ìƒíƒœ ë©”ì„¸ì§€ íŒ¨í„´ ë§¤ì¹­	|

---

h1. suricata command

* "Suricata Command Line Options":https://docs.suricata.io/en/suricata-6.0.3/command-line-options.html
* 
| -h			| ëª…ë ¹ì–´ ëª©ë¡ ì¶œë ¥|
| -c <path>		| ì‚¬ìš©í•  ì„¤ì • íŒŒì¼ ë˜ëŠ” ê²½ë¡œì§€ì •|
| -s <file.rules>	| ì§€ì •í•œ íŒŒì¼ë‚´ì˜ ê·œì¹™ê³¼ í•¨ê²Œ yaml íŒŒì¼ì˜ ê·œì¹™ ë¡œë“œ |
| -S <file.rules>	| ì§€ì •í•œ íŒŒì¼ ë‚´ì˜ ê·œì¹™ë§Œ ë¡œë“œ yamlì— ì§€ì •ë˜ì–´ìˆëŠ” íŒŒì¼ì€ ë¬´ì‹œë¨|
| -v			| ë¡œê¹… ìˆ˜ì¤€ ìƒí–¥ ì¡°ì •
	-v: INFO
	-vv: PERF
	-vvv: CONFIG
	-vvvv: DEBUG|
| -i <interface>	| ìŠ¤ë‹ˆí•‘ ì‹œ ì‚¬ìš©í•  ì¸í„°í˜ì´ìŠ¤ ì§€ì •, ë‹¤ìˆ˜ ì‚¬ìš© ê°€ëŠ¥|
| -l <directory>	| log dirì„ ì„¤ì •
			ì˜µì…˜ì— ì ì€ ê²½ë¡œë¥¼ log dirë¡œ ì¸ì‹
			yamlì— defaultë¡œ ì§€ì •ë˜ì–´ìˆëŠ” ê²½ë¡œëŠ” ë¬´ì‹œëœë‹¤.|
| -r <path>		| íŒ¨í‚·ìº¡ì³ ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì‹¤í–‰
				ë¯¸ë¦¬ ê¸°ë¡ëœ íŒŒì¼ì—ì„œ íŒ¨í‚·ì„ ì½ëŠ”ë‹¤.
				ë””ë ‰í„°ë¦¬ ì§€ì • ì‹œ ë””ë ‰í„°ë¦¬ì˜ ëª¨ë“  íŒŒì¼ê°„ íë¦„ìƒíƒœë¥¼ ìœ ì§€í•˜ë©° ìˆ˜ì •ëœ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬|
| -T			| í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹¤í–‰
				/var/lib/suricata/rules/suricata.rules íŒŒì¼ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¤í–‰|
| -D			| ë°ëª¬ ì‹¤í–‰, ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ëœë‹¤.|
| --pcap-file-continuous| -r ì˜µì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©ëœë‹¤
				ëª¨ë“œê°€ ì¤‘ë‹¨ë  ë•Œê¹Œì§€ í™œì„±ìƒíƒœë¥¼ ìœ ì§€í•¨|
| --pcap-file-recursive	| -r ì˜µì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©ëœë‹¤
				í•˜ìœ„ ë””ë ‰í„°ë¦¬ë¥¼ ì¬ê·€ì ìœ¼ë¡œ ì´ë™í•œë‹¤.
				--pcap-file-continuousì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.|
| --pcap-file-delete	| -r ì˜µì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©ëœë‹¤
				ëª¨ë“œê°€ ì²˜ë¦¬ëœ í›„ pcap íŒŒì¼ì„ ì‚­ì œí•œë‹¤.|
| --runmode <runmode>	| Workers, autofp, Single|
| <notextile>-k [all|none]</notextile>	| ì²´í¬ì„¬ í™•ì¸ì„ ê°•ì œë¡œ(ëª¨ë‘)í•˜ê±°ë‚˜, ì²´í¬ì„¬ í™•ì¸ì„ ë¹„í™œì„±í™” í•œë‹¤.|
| --user=<user>		| í”„ë¡œì„¸ìŠ¤ ì‚¬ìš©ìë¥¼ ì„¤ì •í•œë‹¤.|
| --group=<group>	| í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹ì„ ì„¤ì •í•œë‹¤.|
| --disable-detection	| idsëª¨ë“œ ë¹„í™œì„±í™”|
| --init-errors-fatal	| signaturesë¥¼ ë¡œë”©í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ë°œìƒì‹œ ì‹¤íŒ¨ë¡œ ì¢…ë£Œ|

---

h1. suricata-update

* ê·œì¹™ ê´€ë¦¬ í”„ë¡œê·¸ë¨
* python ì–¸ì–´ë¡œ ì‘ì„±ë¨
* usr/lib/suricata/update ë””ë ‰í„°ë¦¬ì— ì„¤ì¹˜ë¨

h2. ë§¤ì»¤ë‹ˆì¦˜

* í™œì„± ìƒíƒœì˜ ê·œì¹™ì„ ë‹¤ìš´ë¡œë“œ í•˜ì—¬ ì ìš©ì‹œí‚¨ë‹¤.
* ë¹„í™œì„± ìƒíƒœì˜ ê·œì¹™ì€ ë¬´ì‹œëœë‹¤.

h2. ì„¤ì¹˜

<pre><code class="shell">#!/bin/bash


</code></pre>

h2. ê·œì¹™ ê´€ë¦¬

* "ê¸°ë³¸ì œê³µ index.yaml URL":https://www.openinfosecfoundation.org/rules/index.yaml

<pre><code class="shell">#!/bin/bash
# ê¸°ë³¸ê·œì¹™ ë‹¤ìš´ë¡œë“œ ë° ì—…ë°ì´íŠ¸ 
sudo suricata-update
sudo suricata-update update-sources

# ì‚¬ìš© ê°€ëŠ¥ ê·œì¹™ ì¶œë ¥
suricata-update list-sources

# í™œì„±í™”ëœ ê·œì¹™ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
suricata-update list-sources --enabled

# ê·œì¹™ í™œì„±í™”
suricata-update enable-source <ê·œì¹™ëª…>
suricata-update enable-source et/pro

# ê·œì¹™ ë¹„í™œì„±í™”
suricata-update disable-source <ê·œì¹™ëª…>
suricata-update disable-source et/pro

# ê·œì¹™ ì†ŒìŠ¤ ì‚­ì œ
suricata-update remove-source <ê·œì¹™ëª…>
suricata-update remove-source et/pro

# ê·œì¹™ ì†ŒìŠ¤ ì¶”ê°€
suricata-update add-source <name> <url>

suricata-update add-source et https://rules.emergingthreats.net/open/suricata-6.0/emerging.rules.tar.gz
</code></pre>


h2. suricata rule list ì ìš© í…ŒìŠ¤íŠ¸

* suricata-updateë¥¼ í™œìš©í•œ ê·œì¹™ enable/disable í…ŒìŠ¤íŠ¸
* ë£° ì ìš© ì‹œ updateì™€ ì¬ì‹œì‘ì„ í•´ì•¼í•œë‹¤.

<pre><code class="shell">#!/bin/bash
# ìˆ˜ë¦¬ì¹´íƒ€ ë™ì‘
sudo suricata -i eth0

# defaultë£°ì˜ ìš©ëŸ‰ì´ ì»¤ ë‚®ì€ ë£°ì„ ì ìš© (default íšŒí”¼)
sudo suricata-update enable-source oisf/trafficid

# íŒŒì¼ì— ë‚´ìš© ì¶”ê°€
# urlì€ .rule íŒŒì¼ì˜ ì£¼ì†Œ
sudo vi /var/lib/suricata/update/cache/index.yaml
  duruan/test:
    summary: duruan test rule
    vendor: duruan
    description: |
      this rule is made by duruan for testint
    min-version: 6.0.0
    license: MIT
    url: https://raw.githubusercontent.com/poro912/Assignment/main/duruan.rules
    checksum: false

# ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
suricata-update list-sources

# ê·œì¹™ í™œì„±í™”
sudo suricata-update enable-source duruan/test

# í™œì„±í™”ëœ ê·œì¹™ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
suricata-update list-sources --enabled

# suricata ë³€ê²½ ë£° ì ìš©
sudo suricata-update
sudo suricatasc -c ruleset-reload-nonblocking

# ë¡œê·¸ í™•ì¸
tail -f /var/log/suricata/fast.log

# í•‘ ì „ì†¡
ping 8.8.8.8

# ê·œì¹™ ë¹„í™œì„±í™”
sudo suricata-update disable-source duruan/test

# í™œì„±í™”ëœ ê·œì¹™ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
suricata-update list-sources --enabled

# suricata ë³€ê²½ ë£° ì ìš©
sudo suricata-update
sudo suricatasc -c ruleset-reload-nonblocking

# ë¡œê·¸ í™•ì¸
tail -f /var/log/suricata/fast.log

# í•‘ ì „ì†¡
ping 8.8.8.8
</code></pre>
